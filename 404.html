<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<style>
		body{
			display: none;
		}
	</style>
	<meta name="viewport" content="width=device-width, height=device-height">
	<title>不支持</title>
</head>

<body>
	<table><tr><td>
		<div id="not-supported">
			请用<a href="https://www.google.cn/intl/zh-CN/chrome/browser/canary.html">Chrome Canary</a>（仅支持Windows、OSX和Android，安装和更新需<a href="https://github.com/getlantern/forum#%E8%93%9D%E7%81%AFlantern%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E4%B8%8B%E8%BD%BD">翻墙</a>）或<a href="https://download-chromium.appspot.com">Chromium</a>（不能自动更新，需翻墙）浏览本站，并启用下列实验选项：<br>
			- chrome://flags/#enable-javascript-harmony<br>
			- chrome://flags/#enable-experimental-web-platform-features</div>
		<div id="not-found" style="display: none">
		   	404 Not Found</div>
	</td></tr></table>
	<script>
		"use strict";
		
		onerror = function(){
			onerror = null;
			var hash = document.location.hash.slice(1);
			var uri0 = document.location.href;
			var reg = /^[^:]+:\/+[^/]+\//;
			if((uri0.match(reg) || [0])[0] === (hash.match(reg) || [1])[0]){
				history.replaceState(null, null, hash);
				if(document.location.href !== hash) history.replaceState(null, null, uri0);
			}
		};
	</script>
	<script>
		"use strict";

		async () => {};
		Reflect;
		onunhandledrejection;
		document.append();

		document.title = "Loading";
		onerror = null;
		if(top === self){
			try{
				const hash = document.location.hash.slice(1);
				if(!hash.startsWith(document.location.origin)) throw null;
				const uri0 = document.location.href;
				history.replaceState(null, null, hash);
				if(document.location.href !== hash){
					history.replaceState(null, null, uri0);
					throw null;
				}
				if(localStorage.length === 0) localStorage.setItem(`
					"use strict";

					if(top === self){
						try{
							Reflect.deleteProperty(self, "a");
						}catch(error){}
						onload = null;
						[...document.childNodes].forEach(node => {
							if(!(node instanceof DocumentType)) node.remove();
						});
						const meta = document.createElement("meta");
						meta.setAttribute("charset", "utf-8");
						const head = document.createElement("head");
						head.append(meta);
						const html = document.createElement("html");
						html.append(head, document.createElement("body"));
						document.append(html);

						const setup = localStorage.key(0);

						let crash = false;
						const blocker = event => {
							if(crash) event.stopImmediatePropagation();
						};
						const oncrash = (event, description) => {
							const timer = setTimeout(() => {
								localStorage.setItem(setup, \`
									const pre = document.createElement("pre");
									const button = document.createElement("button");
									const promise = new Promise(resolve => {
										document.title = "Crash";
										pre.textContent = unescape("\${escape(description)}");
										button.textContent = "Reload";
										button.autofocus = true;
										button.addEventListener("click", () => {
											button.disabled = true;
											button.textContent = "Reloading";
											resolve();
										});
										document.body.append(pre, button);
									});
									return async () => {
										await promise;
										pre.remove();
										button.remove();
									};
								\`);
								crash = true;
								history.go(0);
							}, 0);
							event.prevent_reload = () => clearTimeout(timer);
						};
						addEventListener("unload", blocker);
						addEventListener("beforeunload", blocker);
						addEventListener("error", event => oncrash(event, event.message + "\\n@" + event.filename + ":" + event.lineno + ":" + event.colno));
						addEventListener("unhandledrejection", event => oncrash(event, event.reason instanceof Error ? event.reason.stack : event.reason));

						let source;
						let cancel;
						let lock = false;
						const update = () => {
							const source1 = localStorage.getItem(setup);
							if(source1 !== source){
								source = source1;
								if(!lock){
									lock = true;
									(async () => {
										await (cancel || (() => {}))();
									})().then(() => {
										Function('"use strict";' + source);
										document.title = "Loading";
										if(localStorage.length === 0) localStorage.setItem(setup, source);
										cancel = self.eval('"use strict"; () => {' + source + "}")();
										lock = false;
									});
								}
							}
						};
						addEventListener("storage", update);
						update();

						const xhr = new XMLHttpRequest;
						const check = () => {
							xhr.open("GET", "/boot.js");
							xhr.setRequestHeader("Cache-Control", "max-age=0");
							xhr.setRequestHeader("token", Date.now() + Math.random().toString().slice(1));
							xhr.send();
						};
						let promise; 
						xhr.addEventListener("loadstart", () => promise = new Promise(resolve => setTimeout(resolve, 6e3)));
						xhr.addEventListener("loadend", () => {
							if(xhr.status === 404 || xhr.status === 304 || xhr.status >= 200 && xhr.status < 300){
								localStorage.setItem(setup, xhr.responseText || "");
								update();
								promise.then(() => requestAnimationFrame(check));
							}else{
								requestAnimationFrame(check);
							}
						});
						check();
					}else{
						document.location.replace("a#" + document.location);
					}
				`, "");
				history.go(0);
			}catch(error){
				document.title = "";
				document.querySelector("#not-supported").style.display = "none";
				document.querySelector("#not-found").style.display = "";
				const xhr = new XMLHttpRequest;
				const check = () => requestAnimationFrame(() => {
					xhr.open("GET", document.location);
					xhr.setRequestHeader("Range", "bytes=0-0");
					xhr.send();
				});
				xhr.addEventListener("loadend", () => xhr.status === 404 ? check() : document.location.reload());
				check();
			}
		}else{
			document.title = "";
			document.querySelector("#not-supported").style.display = "none";
		}
	</script>
	<style>
		body{
			display: block;
			text-align: center;
			overflow: auto;
			border: none;
			margin: 8px;
		}

		table{
			display: inline;
			border-collapse: collapse;
		}

		td{
			padding: 0;
		}

		div{
			font-size: 1.1em;
			font-family: consolas, menlo, 黑体, monospace;
			line-height: 1.8em;
			text-align: left;
		}

		div a:not([hidden]){
			text-decoration: none;
			display: inline-block;
			position: relative;
		}

		div a:link,
		div a:active{
			color: black;
		}

		div a:visited:not([hidden]){
			color: black;
		}

		div a:focus{
			outline: none;
		}

		div a::before,
		div a::after{
			display: block;
			position: absolute;
			width: 100%;
			height: 0;
			bottom: 0;
			border-bottom-width: 1px;
			border-bottom-color: black;
			content: "";
		}

		div a::before{
			border-bottom-style: solid;
		}

		div a:visited::before{
			border-bottom-color: white;
		}

		div a::after{
			border-bottom-style: dashed;
		}

		div a:focus,
		div a:hover{
			background-color: rgba(0, 0, 0, 0.17);
		}
	</style>
</body>

</html>
