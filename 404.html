<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<style>
		body{
			display: none;
		}
	</style>
	<title>不支持</title>
</head>

<body>
	<table><tr><td>
		<div id="not-supported">
		   	请用<a href="https://www.google.cn/intl/zh-CN/chrome/browser/canary.html">Chrome Canary（仅支持Windows和OSX，安装和更新需翻墙）</a>或<a href="https://download-chromium.appspot.com">Chromium（不能自动更新，需翻墙）</a>浏览本站，并启用下列实验选项：<br>
		   	- chrome://flags/#enable-javascript-harmony<br>
		   	- chrome://flags/#enable-experimental-web-platform-features
		</div>
		<div id="not-found" style="display: none">
		   	404 Not Found
		</div>
	</td></tr></table>
	<script>
		"use strict";

		URL;
		Blob;
		Reflect;
		indexedDB;
		SharedWorker;
		MessageChannel;
		localStorage.length;
		async () => /(?<=)/u;
		document.append(...``);

		document.title = "Loading";
		try{
			if(location.hash.length < 2) throw null;
			const uri0 = location.href;
			const uri1 = location.hash.slice(1);
			history.replaceState(null, null, uri1);
			if(location.href !== uri1){
				history.replaceState(null, null, uri0);
				throw null;
			}
			if(localStorage.length === 0) localStorage.setItem(`
				"use strict";

				try{
					Reflect.deleteProperty(self, "a");
				}catch(error){}
				document.write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body></body></html>');
				document.close();

				const setup = localStorage.key(0);

				let crash = false;
				const blocker = event => {
					if(crash) event.stopImmediatePropagation();
				};
				const oncrash = event => {
					const timer = setTimeout(() => {
						localStorage.setItem(setup, \`
							const pre = document.createElement("pre");
							const button = document.createElement("button");
							const promise = new Promise(resolve => {
								document.title = "Crash";
								pre.textContent = unescape("\${escape((event.error || {}).stack || event.message)}");
								button.textContent = "Reload";
								button.addEventListener("click", () => {
									resolve();
									button.disabled = true;
									button.textContent = "Reloading";
								});
								document.body.append(pre, button);
							});
							return async () => {
								await promise;
								pre.remove();
								button.remove();
							};
						\`);
						crash = true;
						location.reload();
					}, 0);
					event.prevent_reload = () => clearTimeout(timer);
				};
				addEventListener("unload", blocker);
				addEventListener("beforeunload", blocker);
				addEventListener("error", oncrash);
				addEventListener("unhandledrejection", oncrash);

				let source;
				let cancel;
				let lock = false;
				const update = () => {
					const source1 = localStorage.getItem(setup);
					if(source1 !== source){
						source = source1;
						if(!lock){
							lock = true;
							(async () => {
								await (cancel || (() => {}))();
							})().then(() => {
								Function('"use strict";' + source);
								document.title = "Loading";
								if(localStorage.length === 0) localStorage.setItem(setup, source);
								cancel = self.eval('"use strict"; () => {' + source + "}")();
								lock = false;
							});
						}
					}
				};
				addEventListener("storage", update);
				update();

				const xhr = new XMLHttpRequest;
				const check = () => {
					xhr.open("GET", "/boot.js");
					xhr.setRequestHeader("Cache-Control", "max-age=0");
					xhr.setRequestHeader("token", Date.now() + Math.random().toString().slice(1));
					xhr.send();
				};
				let promise; 
				xhr.addEventListener("loadstart", () => promise = new Promise(resolve => setTimeout(resolve, 6e3)));
				xhr.addEventListener("loadend", () => {
					if(xhr.status === 404 || xhr.status === 304 || xhr.status >= 200 && xhr.status < 300){
						localStorage.setItem(setup, xhr.responseText || "");
						update();
						promise.then(() => requestAnimationFrame(check));
					}else{
						requestAnimationFrame(check);
					}
				});
				check();
			`, "");
			location.reload();
		}catch(error){
			document.title = "";
			document.querySelector("#not-supported").style.display = "none";
			if(top === self){
				document.querySelector("#not-found").style.display = "";
				const xhr = new XMLHttpRequest;
				const check = () => requestAnimationFrame(() => {
					xhr.open("GET", location);
					xhr.setRequestHeader("Range", "bytes=0-0");
					xhr.send();
				});
				xhr.addEventListener("loadend", () => xhr.status === 404 ? check() : location.reload());
				check();
			}else{
				const onload = () => {
					removeEventListener("load", onload);
					document.write('<!DOCTYPE html><html><head><meta charset="utf-8"></head><body></body></html>');
					document.close();
				};
				addEventListener("load", onload);
			}
		}
	</script>
	<style>
		body{
			display: block;
			text-align: center;
			overflow: auto;
			border: none;
			margin: 8px;
		}

		table{
			display: inline;
			border-collapse: collapse;
		}

		td{
			padding: 0;
		}

		div{
			font-size: 1.1em;
			font-family: consolas, menlo, 黑体, monospace;
			line-height: 1.8em;
			text-align: left;
		}

		div a:not([hidden]){
			text-decoration: none;
			display: inline-block;
			position: relative;
		}

		div a:link,
		div a:active{
			color: black;
		}

		div a:visited:not([hidden]){
			color: black;
		}

		div a:focus{
			outline: none;
		}

		div a::before,
		div a::after{
			display: block;
			position: absolute;
			width: 100%;
			height: 0;
			bottom: 0;
			border-bottom-width: 1px;
			border-bottom-color: black;
			content: "";
		}

		div a::before{
			border-bottom-style: solid;
		}

		div a:visited::before{
			border-bottom-color: white;
		}

		div a::after{
			border-bottom-style: dashed;
		}

		div a:focus,
		div a:hover{
			background-color: rgba(0, 0, 0, 0.17);
		}
	</style>
</body>

</html>
